#!/bin/sh

set -eu

# Source the bouncer script if it exists
if [ -f "/usr/lib/$DPKG_MAINTSCRIPT_PACKAGE/_bouncer.sh" ]; then
    #shellcheck source=./scripts/_bouncer.sh
    . "/usr/lib/$DPKG_MAINTSCRIPT_PACKAGE/_bouncer.sh"
else
    # Fallback if _bouncer.sh is not available
    BOUNCER="crowdsec-spoa-bouncer"
    CONFIG="/etc/crowdsec/bouncers/$BOUNCER.yaml"
fi

if [ "$1" = "purge" ]; then
    if [ -f "$CONFIG.id" ]; then
        bouncer_id=$(cat "$CONFIG.id")
        cscli -oraw bouncers delete "$bouncer_id" 2>/dev/null || true
        rm -f "$CONFIG.id"
    fi
fi
